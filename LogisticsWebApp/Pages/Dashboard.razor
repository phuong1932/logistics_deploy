@page "/dashboard"
@layout DashBoardLayout
@attribute [Authorize(Roles = "admin,user,staff")]
@inject IHttpClientFactory HttpClientFactory
@using LogisticsWebApp.DTO

<div class="dashboard-page">
    <div class="page-header">
        <h2>üìä Dashboard - T·ªïng quan h·ªá th·ªëng</h2>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon" style="background: #4CAF50;">
                üì¶
            </div>
            <div class="stat-info">
                <h3>@dashboardResult.CargoCount</h3>
                <p>ƒê∆°n h√†ng th√°ng n√†y</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: #2196F3;">
                üí∞
            </div>
            <div class="stat-info">
                <h3>@dashboardResult.TotalRevenueFormatted</h3>
                <p>Doanh thu th√°ng</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: #FF9800;">
                üìä
            </div>
            <div class="stat-info">
                <h3>@dashboardResult.AverageRevenueFormatted</h3>
                <p>TB/ƒë∆°n h√†ng</p>
            </div>
        </div>

   
    </div>


</div>

@code {
    private DashboardVM dashboardResult = new DashboardVM();
    protected override async Task OnInitializedAsync()
    {
        await LoadMonthlyStatistics();
    }

    private async Task LoadMonthlyStatistics()
    {
        try
        {
            var client = HttpClientFactory.CreateClient("LogisticApi");
            var response = await client.GetAsync("Cargo/monthlystatistics");
            
            if (response.IsSuccessStatusCode)
            {
                var jsonContent = await response.Content.ReadAsStringAsync();
                
                if (response.IsSuccessStatusCode)
                {
                    dashboardResult = JsonSerializer.Deserialize<DashboardVM>(jsonContent, new JsonSerializerOptions
                {
                    PropertyNameCaseInsensitive = true
                }) ?? new DashboardVM();
   
            }
            }
        }
        catch (Exception ex)
        {
            // Log error ho·∫∑c hi·ªÉn th·ªã th√¥ng b√°o l·ªói
            Console.WriteLine($"L·ªói khi t·∫£i th·ªëng k√™: {ex.Message}");
        }
        
    }

 
}
 